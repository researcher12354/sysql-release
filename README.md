# SysQL

SysQL is a system that enables efficient attack investigation via syntergistically integrating attack pattern search and causal dependency tracking. The system leverages existing system auditing frameworks (Sysdig, ProcMon) to collect system audit logs, and parses the logs into PostgreSQL and Neo4j databases. To faciliitate the iterative invesitgation process, the system provides a domain-specific language, System Provenance Query Language (SysQL), enabling security analysts to incorporate expert knowledge in the attack investigation process.

For more information, please refer to our paper.

Built using Java SE 14.

## Sysdig Logs Parser
Given a log generated by Sysdig, parse it, and store the information in a PostgreSql database.

To run:
- Modify database config in `cfg/postgres.properties`
- Modify the parameter `logFile` in `src/main/SysdigMain.java` to the path of your .txt log file
- Run `SysdigMain`
- DB will be auomatically created according to our specified schema, and tables should be then available for querying in the DB

Parameters in SysdigMain:
- logFile: path to .txt log file

## Windows ProcMon Log Parser
Given a log file (.csv) generated by Procmon, parse it, and store the information in a PostgreSql database.

To run:
- Modify database config in `cfg/postgres.properties`
- Modify the parameter `logFile` in `src/main/ProcmonMain.java` to the path of your .csv log file
- Run `ProcmonMain`
- DB will be auomatically created according to our specified schema, and tables should be then available for querying in the DB

Parameters in ProcmonMain:
- logFile: path to .csv log file
- timezone: the timezone of the machine that collects the log
- serverIP: server IP

## Running queries

Edit the query in `input/query.txt` after populating the DB with data from logging.
Run `ExecutorMain` to execute the query. Alternatively, provide a file path as
an argument to `ExecutorMain` instead of using `input/query.txt`.
Multiple queries can be written in the file or `inputStream` to be executed sequentially.

Use `-n` flag to use Neo4j database. Otherwise, the default PostgreSQL database will be used.

Use `-r` flag in arguments to compile to standalone recursive SQL queries (or Cypher queries) instead of using the SysQL query scheduler.

> You can try the sample query by running `./run_sample`.

## Running queries of evaluation cases

Load logs to corresponding databases (refer to each query `input.txt` in `eval/queries/` for the names of databases) and run `./run_eval`. The outputs should appear in output.txt in the same folders.
